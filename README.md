# Telegram Channel Parser (Console Mode)

Этот проект позволяет загружать и отображать сообщения из публичных Telegram каналов в консоли, а также сохранять их в единый JSON-файл (output/messages.json).

## Установка

Для установки проекта клонируйте репозиторий и выполните следующие команды:

```bash
pnpm install
cp ./.env-example ./.env
```

## Требования

- Node.js LTS
- Учетная запись Telegram

## Конфигурация

В файле `.env` должны быть указаны параметры для авторизации пользователя:

Пример `.env`:
```
API_ID=...
API_HASH=...
CHANNEL_USERNAME=...
PHONE_NUMBER=...
TWO_FACTOR_PASSWORD=... # если есть
```

## Работа приложения

После авторизации приложение начнет загрузку сообщений из указанного канала и будет:
1. Выводить их в консоль в формате:
   ```
   ----- Сообщение #123456 (01.01.2023, 12:00:00) -----
   Текст: Текст сообщения
   Медиа: Photo
   ----------------------------------------
   ```
2. Сохранять их в файл `output/messages.json` (единый для всех каналов и запусков).

**Формат файла:**

JSON-файл содержит только массив сообщений, без дополнительных полей:
```json
[
  {
    "id": 123456,
    "date": 1672531200,
    "text": "Текст сообщения",
    "media": "Photo",
    "heading": "Заголовок",
    "tags": ["tag1", "tag2"],
    "photoPath": "output/photos/photo_123456.jpg"
  },
  // ... другие сообщения
]
```
- Если сообщение с таким id уже есть, его текст обновляется.
- Новые сообщения добавляются.
- Все сообщения в файле отсортированы по date от позднего к раннему (сначала самые новые).

## Завершение работы

Для завершения работы приложения:
- Используйте CTRL + C в терминале.

## FAQ

### Как получить данные канала по `channelId`

> Может не работать для некоторых каналов

```typescript
const channel = await client.getEntity(`-100${channelId}`)
```

### Как получить канал по `channelName`

```typescript
const channels = await client.invoke(
  new Api.channels.GetChannels({
    id: ['channelName'],
  }),
);
```

### Почему бот не получает историю сообщений?

Боты в Telegram имеют ограниченный доступ к сообщениям. Они могут получать только:
1. Новые сообщения, отправленные после добавления бота в канал
2. Сообщения, к которым бот имеет прямой доступ согласно правам
3. События и обновления, на которые бот подписан

Для получения полной истории сообщений канала используйте авторизацию через пользовательский аккаунт.

### Как использовать библиотеку GramJS напрямую?

Это приложение построено на библиотеке GramJS (npm пакет `telegram`). Если вы хотите использовать API напрямую, можно вызывать методы через функцию `invoke`:

```typescript
const result = await client.invoke(
  new Api.ИмяМетода({
    параметр1: значение1,
    параметр2: значение2,
  }),
);
```

Полный список доступных методов можно найти в [документации Telegram API](https://core.telegram.org/methods).
